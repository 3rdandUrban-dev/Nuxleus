(function(a){var b=a.App;b.Twitter=b.BaseModel.extend({defaults:{screenName:null,tab:"timelines",timelines:[],tweets:[],friends:[],followers:[]},initialize:function(a){_.bindAll(this,"twitterProfileChange","onChange","twitterTab");var b=this;this.profile=a.profile,this.profile.bind("change",function(a){b.twitterProfileChange(a.get("twitterScreenName"))}),this.bind("change",this.onChange)},onChange:function(){console.log("twitter.onChange:"+this.tab());var a=!!this.get("screenName");$("BODY").toggleClass("authenticated-twitter",a),a?this.load(this.tab()):this.clear({silent:!0})},load:function(a){a=a||this.defaults.tab;var b=this,c={},d=a==="directmessages"?a:this.get("screenName")+"/"+a;_.get("api/twitter/"+d,function(d){c[a]=d.results,b.set(c)})},twitterProfileChange:function(a,b){b=b||this.tab(),console.log("twitter.twitterProfileChange: "+b);if(!a){this.set({screenName:this.profile.get("twitterScreenName")}),$("BODY").toggleClass("self",this.viewingSelf());return}var c=this;_.get("api/twitter/"+a,function(d){var e=_.defaults({screenName:a},c.defaults);_.extend(e,d.results[0]),e.tab=b,c.set(e),$("BODY").toggleClass("self",c.viewingSelf()),c.navigate(c.navUrl())})},viewingSelf:function(){return this.profile.get("twitterScreenName")===this.get("screenName")},navUrl:function(){return(this.viewingSelf()?"":this.get("screenName")+"/")+this.get("tab")},tab:function(){return this.get("tab")||this.defaults.tab},twitterTab:function(a){a=a||this.tab(),console.log("twitterTab:"+a),this.set({tab:a}),$(".tabs [href=#"+a+"]").click(),this.navigate(this.navUrl())}}),b.TwitterView=b.BaseView.extend({initialize:function(){_.bindAll(this,"render"),this.model.bind("change",this.render),this.$el=$(this.el),this.$signedInBody=this.$el.find(".signed-in .tab-content"),this.tweetsTemplate=_.template($("#template-tweets").html()),this.usersTemplate=_.template($("#template-users").html()),this.directMessagesTemplate=_.template($("#template-directmessages").html()),this.currentUserTemplate=_.template($("#template-current-user").html())},tabHooks:{friends:function(){return this.usersTemplate({users:this.model.get("friends")})},followers:function(){return this.usersTemplate({users:this.model.get("followers")})},timelines:function(){return this.tweetsTemplate({tweets:this.model.get("timelines")})},tweets:function(){return this.tweetsTemplate({tweets:this.model.get("tweets")})},directmessages:function(){return this.directMessagesTemplate({tweets:this.model.get("directmessages")})}},render:function(){var a=this.model.get("screenName"),b="";if(a){var c=this.model.get("tab");b=this.tabHooks[c].call(this),this.$(".current-user").html(this.currentUserTemplate(this.model.toJSON()));var d=this.model.get("profile_background_image_url"),e=this.model.get("profile_background_color")||"",f=this.model.get("profile_background_tile")==="true"?"":"no-repeat",g=d?"#"+e+" url("+d+") "+f+" top left":"";$("BODY").css({background:g,"background-attachment":"fixed"})}this.$signedInBody.html(b)}})})(window)