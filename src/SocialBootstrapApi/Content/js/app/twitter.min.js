(function(a){var b=a.App;b.Twitter=b.BaseModel.extend({defaults:{screenName:null,tab:"tweets",tweets:[],friends:[],followers:[]},initialize:function(a){_.bindAll(this,"twitterProfileChange","onChange","twitterTab");var b=this;this.profile=a.profile,this.profile.bind("change",function(a){b.twitterProfileChange(a.get("twitterScreenName"))}),this.bind("change",this.onChange)},onChange:function(){console.log("twitter.onChange:"+this.tab());var a=!!this.get("screenName");$("BODY").toggleClass("authenticated-twitter",a),a?this.load(this.tab()):this.clear({silent:!0})},load:function(a){a=a||this.defaults.tab;var b=this,c={};_.get("api/twitter/"+this.get("screenName")+"/"+a,function(d){c[a]=d.results,b.set(c)})},twitterProfileChange:function(a,b){b=b||this.tab(),console.log("twitter.twitterProfileChange: "+b);if(!a){this.set({screenName:this.profile.get("twitterScreenName")}),$("BODY").toggleClass("self",this.viewingSelf());return}var c=this;_.get("api/twitter/"+a,function(d){var e=_.defaults({screenName:a},c.defaults);_.extend(e,d.results[0]),e.tab=b,c.set(e),$("BODY").toggleClass("self",c.viewingSelf()),c.navigate(c.navUrl())})},viewingSelf:function(){return this.profile.get("twitterScreenName")===this.get("screenName")},navUrl:function(){return(this.viewingSelf()||this.get("tab")=="directmessages"?"":this.get("screenName")+"/")+this.get("tab")},tab:function(){return this.get("tab")||this.defaults.tab},twitterTab:function(a){a=a||this.tab(),console.log("twitterTab:"+a),this.set({tab:a}),$(".tabs [href=#"+a+"]").click(),this.navigate(this.navUrl())}}),b.TwitterView=b.BaseView.extend({initialize:function(){_.bindAll(this,"render"),this.model.bind("change",this.render),this.$el=$(this.el),this.$signedOut=this.$el.find(".signed-out"),this.$signedIn=this.$el.find(".signed-in"),this.$signedInBody=this.$el.find(".signed-in .tab-content"),this.tweetsTemplate=_.template($("#template-tweets").html()),this.usersTemplate=_.template($("#template-users").html()),this.currentUserTemplate=_.template($("#template-current-user").html())},render:function(){var a=this.model.get("screenName"),b=!!a,c="";console.log("twitter.render:"+a);if(a){var d=this.model.get("tab");c=d==="friends"?this.usersTemplate({users:this.model.get("friends")}):d=="followers"?this.usersTemplate({users:this.model.get("followers")}):this.tweetsTemplate({tweets:this.model.get("tweets")}),this.$(".current-user").html(this.currentUserTemplate(this.model.toJSON()));var e=this.model.get("profile_background_image_url"),f=this.model.get("profile_background_color")||"",g=this.model.get("profile_background_tile")==="true"?"":"no-repeat",h=e?"#"+f+" url("+e+") "+g+" top left":"";$("BODY").css({background:h,"background-attachment":"fixed"})}this.$signedInBody.html(c)}})})(window)